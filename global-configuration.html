<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Global Configuration &#8212; FoundationDB 7.1</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '7.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="Special Keys" href="special-keys.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          FoundationDB</a>
        <span class="navbar-text navbar-version pull-left"><b>7.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="contents.html">Site Map</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Global Configuration</a><ul>
<li><a class="reference internal" href="#reading-data">Reading data</a></li>
<li><a class="reference internal" href="#writing-data">Writing data</a><ul>
<li><a class="reference internal" href="#clearing-data">Clearing data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#watching-data">Watching data</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="special-keys.html" title="Previous Chapter: Special Keys"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Special Keys</span>
    </a>
  </li>
  <li>
    <a href="tutorials.html" title="Next Chapter: Tutorials"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Tutorials &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Global Configuration</a><ul>
<li><a class="reference internal" href="#reading-data">Reading data</a></li>
<li><a class="reference internal" href="#writing-data">Writing data</a><ul>
<li><a class="reference internal" href="#clearing-data">Clearing data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#watching-data">Watching data</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="id1">
<h1>Global Configuration</h1>
<p>The global configuration framework is an eventually consistent configuration
mechanism to efficiently make runtime changes to all clients and servers. It
works by broadcasting updates made to the global configuration key space,
relying on individual machines to store existing configuration in-memory.</p>
<p>The global configuration framework provides a key-value interface to all
processes and clients in a FoundationDB cluster.</p>
<p>The global configuration framework is internal to FoundationDB and clients will
usually have no need to interact with it. The API is provided here for
reference.</p>
<div class="section" id="reading-data">
<h2>Reading data</h2>
<p>The global configuration framework is exposed through the
<code class="docutils literal"><span class="pre">GlobalConfig::globalConfig()</span></code> static function. There are separate ways to
read a value, depending on if it is an object or a primitive.</p>
<dl class="function">
<dt id="_CPPv2I0E3get6KeyRef1T">
template&lt;class <code class="descname">T</code>&gt;<br /><em class="property">const</em> <a class="reference internal" href="#_CPPv2I0E3get6KeyRef1T" title="get::T">T</a> <code class="descclassname"></code><code class="descname">get</code><span class="sig-paren">(</span>KeyRef <em>name</em>, <a class="reference internal" href="#_CPPv2I0E3get6KeyRef1T" title="get::T">T</a> <em>defaultVal</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Returns the value associated with <code class="docutils literal"><span class="pre">name</span></code> stored in global configuration,
or <code class="docutils literal"><span class="pre">defaultVal</span></code> if no key matching <code class="docutils literal"><span class="pre">name</span></code> exists. This templated
function is enabled only when the <code class="docutils literal"><span class="pre">std::is_arithmetic&lt;T&gt;</span></code> specialization
returns true.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobalConfig</span><span class="o">::</span><span class="n">globalConfig</span><span class="p">();</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;path/to/key&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="_CPPv23get6KeyRef">
<span id="get__KeyRef"></span><em class="property">const</em> Reference&lt;<a class="reference internal" href="#_CPPv211ConfigValue" title="ConfigValue">ConfigValue</a>&gt; <code class="descclassname"></code><code class="descname">get</code><span class="sig-paren">(</span>KeyRef <em>name</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Returns the value associated with <code class="docutils literal"><span class="pre">name</span></code> stored in global configuration.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobalConfig</span><span class="o">::</span><span class="n">globalConfig</span><span class="p">();</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">configValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;path/to/key&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Check if value exists</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="n">configValue</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">has_value</span><span class="p">());</span><span class="w"></span>
<span class="c1">// Cast to correct type</span>
<span class="k">auto</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">any_cast</span><span class="o">&lt;</span><span class="n">StringRef</span><span class="o">&gt;</span><span class="p">(</span><span class="n">configValue</span><span class="p">.</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="_CPPv23get11KeyRangeRef">
<span id="get__KeyRangeRef"></span><em class="property">const</em> std::map&lt;KeyRef, Reference&lt;<a class="reference internal" href="#_CPPv211ConfigValue" title="ConfigValue">ConfigValue</a>&gt;&gt; <code class="descclassname"></code><code class="descname">get</code><span class="sig-paren">(</span>KeyRangeRef <em>range</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Returns all values in the specified range.</p>
</dd></dl>

<dl class="type">
<dt id="_CPPv211ConfigValue">
<span id="ConfigValue"></span><em class="property">type </em><code class="descclassname"></code><code class="descname">ConfigValue</code><br /></dt>
<dd><p>Holds a global configuration value and the arena where it lives.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">ConfigValue</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ReferenceCounted</span><span class="o">&lt;</span><span class="n">ConfigValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">Arena</span><span class="w"> </span><span class="n">arena</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">any</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">arena</span></code></dt>
<dd>The arena where the value (and the associated key) lives in memory.</dd>
<dt><code class="docutils literal"><span class="pre">value</span></code></dt>
<dd>The stored value.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="writing-data">
<h2>Writing data</h2>
<p>Writing data to global configuration is done using transactions written to the
special key space range <code class="docutils literal"><span class="pre">\xff\xff/global_config/</span> <span class="pre">-</span> <span class="pre">\xff\xff/global_config/0</span></code>.
Values must always be encoded according to the <a class="reference internal" href="api-python.html#api-python-tuple-layer"><span class="std std-ref">Tuple layer</span></a>.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// In GlobalConfig.actor.h</span>
<span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">KeyRef</span><span class="w"> </span><span class="n">myGlobalConfigKey</span><span class="p">;</span><span class="w"></span>
<span class="c1">// In GlobalConfig.actor.cpp</span>
<span class="k">const</span><span class="w"> </span><span class="n">KeyRef</span><span class="w"> </span><span class="n">myGlobalConfigKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LiteralStringRef</span><span class="p">(</span><span class="s">&quot;config/key&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// When you want to set the value..</span>
<span class="n">Tuple</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tuple</span><span class="p">().</span><span class="n">appendDouble</span><span class="p">(</span><span class="mf">1.5</span><span class="p">);</span><span class="w"></span>

<span class="n">FDBTransaction</span><span class="o">*</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"></span>
<span class="n">tr</span><span class="o">-&gt;</span><span class="n">setOption</span><span class="p">(</span><span class="n">FDBTransactionOptions</span><span class="o">::</span><span class="n">SPECIAL_KEY_SPACE_ENABLE_WRITES</span><span class="p">);</span><span class="w"></span>
<span class="n">tr</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">GlobalConfig</span><span class="o">::</span><span class="n">prefixedKey</span><span class="p">(</span><span class="n">myGlobalConfigKey</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">pack</span><span class="p">());</span><span class="w"></span>
<span class="c1">// commit transaction</span>
</pre></div>
</div>
<p>The client is responsible for avoiding conflicts with other global
configuration keys. For most uses, it is recommended to create a new key space.
For example, an application that wants to write configuration data should use
the <code class="docutils literal"><span class="pre">global_config/config/</span></code> namespace, instead of storing keys in the top
level <code class="docutils literal"><span class="pre">global_config/</span></code> key space.</p>
<div class="section" id="clearing-data">
<h3>Clearing data</h3>
<p>Data can be removed from global configuration using standard transaction
semantics. Submit a clear or clear range to the appropriate global
configuration keys in the special key space to clear data.</p>
</div>
</div>
<div class="section" id="watching-data">
<h2>Watching data</h2>
<p>Global configuration provides functionality to watch for changes.</p>
<dl class="function">
<dt id="_CPPv213onInitializedv">
<span id="onInitialized"></span>Future&lt;Void&gt; <code class="descclassname"></code><code class="descname">onInitialized</code><span class="sig-paren">(</span><span class="sig-paren">)</span><br /></dt>
<dd><p>Returns a <code class="docutils literal"><span class="pre">Future</span></code> which will be triggered when global configuration has
been successfully initialized and populated with data.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv28onChangev">
<span id="onChange"></span>Future&lt;Void&gt; <code class="descclassname"></code><code class="descname">onChange</code><span class="sig-paren">(</span><span class="sig-paren">)</span><br /></dt>
<dd><p>Returns a <code class="docutils literal"><span class="pre">Future</span></code> which will be triggered when any key-value pair in
global configuration changes.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv27trigger6KeyRefNSt8functionIFvNSt8optionalINSt3anyEEEEEE">
void <code class="descclassname"></code><code class="descname">trigger</code><span class="sig-paren">(</span>KeyRef <em>key</em>, std::function&lt;void<span class="sig-paren">(</span>std::optional&lt;std::any&gt;<span class="sig-paren">)</span>&gt; <em>fn</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Registers a callback to be called when the value for global configuration
key <code class="docutils literal"><span class="pre">key</span></code> is changed. The callback function takes a single argument, an
optional which will be populated with the updated value when <code class="docutils literal"><span class="pre">key</span></code> is
changed, or an empty optional if the value was cleared. If the value is an
allocated object, its memory remains in control of global configuration.</p>
</dd></dl>

</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/global-configuration.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2021 Apple, Inc and the FoundationDB project authors.<br/>
      Last updated on Apr 28, 2022.<br/>
    </p>
  </div>
</footer>
  </body>
</html>
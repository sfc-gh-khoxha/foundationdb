<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Transaction profiling and analyzing &#8212; FoundationDB 7.1</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '7.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Version Upgrade Guide" href="api-version-upgrade-guide.html" />
    <link rel="prev" title="Known Limitations" href="known-limitations.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          FoundationDB</a>
        <span class="navbar-text navbar-version pull-left"><b>7.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="contents.html">Site Map</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Transaction profiling and analyzing</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#additional-packages">Additional packages</a></li>
<li><a class="reference internal" href="#sample-usage">Sample usage</a></li>
<li><a class="reference internal" href="#using-filters">Using filters:</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="known-limitations.html" title="Previous Chapter: Known Limitations"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Known Limitations</span>
    </a>
  </li>
  <li>
    <a href="api-version-upgrade-guide.html" title="Next Chapter: API Version Upgrade Guide"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">API Version U... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Transaction profiling and analyzing</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#additional-packages">Additional packages</a></li>
<li><a class="reference internal" href="#sample-usage">Sample usage</a></li>
<li><a class="reference internal" href="#using-filters">Using filters:</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="transaction-profiling-and-analyzing">
<span id="transaction-profiler-analyzer"></span><h1>Transaction profiling and analyzing</h1>
<p>FoundationDB natively implements transaction profiling and analyzing. There are two ways to enable transaction profiling in FoundationDB. One is globally through the database, via <code class="docutils literal"><span class="pre">fdbcli</span></code> command which sets keys in the database and the clients pick it up.</p>
<p><code class="docutils literal"><span class="pre">e.g.</span>&#160; <span class="pre">fdbcli&gt;</span> <span class="pre">profile</span> <span class="pre">client</span> <span class="pre">set</span> <span class="pre">0.01</span> <span class="pre">100MB</span></code> profiles 1% of transactions and maintains 100MB worth of history in the database.</p>
<p>Second way is through client side knobs <code class="docutils literal"><span class="pre">CSI_SAMPLING_PROBABILITY</span></code> and <code class="docutils literal"><span class="pre">CSI_SIZE_LIMIT</span></code> which have to be set at every client that you want to profile. Enabling transaction profiling through the database setting has higher precedence and overrides any client knob settings.</p>
<p>There are only two inputs for transaction profiling i.e. sampling rate and the size limit.</p>
<p>The transactions are sampled at the specified rate and all the events for that sampled transaction are recorded. Then at 30 second interval, the data for all the sampled transactions during that interval is flushed to the database. The sampled data is written into special key space <code class="docutils literal"><span class="pre">“\xff\x02/fdbClientInfo/</span> <span class="pre">-</span> <span class="pre">\xff\x02/fdbClientInfo0”</span></code></p>
<p>The second part of transaction profiling involves deleting old sampled data to restrict the size. Retention is purely based on the input size limit. If the size of all the recorded data exceeds the input limit, then the old ones get deleted. But the limit is a soft limit, you could go over the limit temporarily.</p>
<p>There are many ways that this data can be exposed for analysis. One can imagine building a client that reads the data from the database and streams it to external tools such as Wavefront.</p>
<p>One such tool that’s available as part of open source FDB is a python script called <code class="docutils literal"><span class="pre">transaction_profiling_analyzer.py</span></code> that&#8217;s available here on <a class="reference external" href="https://github.com/apple/foundationdb/blob/main/contrib/transaction_profiling_analyzer/transaction_profiling_analyzer.py">GitHUb</a>. It reads the sampled data from the database and outputs it in a user friendly format. Currently it’s most useful in identifying hot key-ranges (for both reading and writing).</p>
<div class="section" id="prerequisites">
<h2>Prerequisites</h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">python3</span></code></li>
<li><code class="docutils literal"><span class="pre">fdb</span> <span class="pre">python</span> <span class="pre">bindings</span></code> - If you don&#8217;t have the Python bindings installed, you can append $BUILDDIR/bindings/python to the PYTHONPATH  environment variable, then you should be able to import fdb</li>
</ul>
</div>
<div class="section" id="additional-packages">
<h2>Additional packages</h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">dateparser</span></code> - for human date parsing</li>
<li><code class="docutils literal"><span class="pre">sortedcontainers</span></code> - for estimating key range read/write density</li>
</ul>
</div>
<div class="section" id="sample-usage">
<h2>Sample usage</h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">$python3</span> <span class="pre">transaction_profiling_analyzer.py</span> <span class="pre">--help</span></code> - Shows the help message and exits</li>
<li><code class="docutils literal"><span class="pre">python3</span> <span class="pre">transaction_profiling_analyzer.py</span> <span class="pre">-C</span> <span class="pre">fdb.cluster</span> <span class="pre">--start-time</span> <span class="pre">&quot;17:00</span> <span class="pre">2020/07/07</span> <span class="pre">PDT&quot;</span> <span class="pre">--end-time</span> <span class="pre">&quot;17:50</span> <span class="pre">2020/07/07</span> <span class="pre">PDT&quot;</span></code> - Analyzes and prints full information between a start and end time frame</li>
</ul>
</div>
<div class="section" id="using-filters">
<h2>Using filters:</h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">python3</span> <span class="pre">~/transaction_profiling_analyzer.py</span> <span class="pre">-C</span> <span class="pre">fdb.cluster</span> <span class="pre">--filter-get</span> <span class="pre">--start-time</span> <span class="pre">&quot;17:00</span> <span class="pre">2020/07/07</span> <span class="pre">PDT&quot;</span> <span class="pre">--end-time</span> <span class="pre">&quot;17:50</span> <span class="pre">2020/07/07</span> <span class="pre">PDT&quot;</span></code> - Analyzes and prints information about gets between a start and end time frame</li>
<li><code class="docutils literal"><span class="pre">python3</span> <span class="pre">~/transaction_profiling_analyzer.py</span> <span class="pre">-C</span> <span class="pre">fdb.cluster</span> <span class="pre">--filter-get</span> <span class="pre">--start-time</span> <span class="pre">&quot;17:00</span> <span class="pre">2020/07/07</span> <span class="pre">PDT&quot;</span> <span class="pre">--end-time</span> <span class="pre">&quot;17:50</span> <span class="pre">2020/07/07</span> <span class="pre">PDT&quot;</span> <span class="pre">--top-requests</span> <span class="pre">5</span></code> - Analyzes and prints information about top 5 keys for gets between a start and end time frame</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/transaction-profiler-analyzer.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2021 Apple, Inc and the FoundationDB project authors.<br/>
      Last updated on Apr 28, 2022.<br/>
    </p>
  </div>
</footer>
  </body>
</html>